# OnlyFollow - 项目总览

## 📖 项目概述

OnlyFollow 是一个 Chrome 扩展插件，旨在将各大平台的算法推荐替换为用户关注内容的随机展示，让用户重新掌控信息流。

**核心目标**: 将各大平台的算法推荐替换为用户关注内容的随机展示，让用户重新掌控信息流。

**支持平台**: Bilibili、YouTube、Twitter、Instagram（可扩展）

**技术栈**:
- 运行时: Bun 1.2.4
- 语言: TypeScript
- 前端框架: React 19
- 构建工具: ESBuild
- 样式: TailwindCSS + shadcn
- 状态管理: Zustand
- 格式工具: Biome

## 🏗️ 架构设计

### 核心模块

#### 1. 平台适配器系统
每个支持的平台都有独立的文件，负责处理该平台特有的API调用、DOM操作和数据格式转换。

**核心职责**:
- 检测当前页面是否属于目标平台
- 获取用户的关注列表
- 获取关注对象发布的内容
- 识别并定位页面中的推荐内容区域
- 将获取的内容渲染到页面中

#### 2. 内容获取引擎
负责从各个平台获取用户关注的内容，并进行处理、筛选和排序。

**核心职责**:
- 管理关注列表的获取和更新
- 从关注对象中随机选择一批用户
- 批量获取这些用户发布的内容
- 对内容进行去重、过滤和排序
- 维护一个内容池供展示使用

#### 3. DOM替换引擎
负责识别页面中的推荐内容区域，并将其替换为从关注对象获取的内容。

**核心职责**:
- 监听页面DOM变化，等待推荐内容加载
- 定位推荐内容的容器元素
- 创建符合平台风格的内容卡片
- 将推荐内容替换为关注内容

#### 4. 缓存管理系统
管理所有数据的缓存，包括关注列表、用户内容和媒体资源，以减少API调用次数。

**分层缓存策略**:
- 关注列表缓存: 24小时
- 视频内容缓存: 2小时
- 媒体资源缓存: 7天

#### 5. 配置管理系统
管理用户的所有配置选项，包括平台开关、内容偏好、UI设置等。

**核心职责**:
- 存储用户配置
- 提供配置的读取和更新接口
- 处理配置的同步和备份
- 提供默认配置
- 验证配置的有效性

#### 6. 查看面板
用来查看当前项目缓存了哪些内容，可以手动删除。使用表格或列表式展现缓存状态。

## ✅ 已实现功能

### 哔哩哔哩平台支持
- **关注列表获取**: 完整实现 Bilibili 关注列表 API 调用
- **视频内容获取**: 获取 UP 主视频池，支持随机选择
- **DOM 替换**: 智能识别并替换首页推荐视频卡片
- **缓存机制**: 关注列表缓存 24 小时，视频内容缓存 2 小时

### 内容引擎
- **随机化算法**: 多层随机化确保内容的多样性
- **并发控制**: 批量处理 API 请求，避免频率限制
- **错误处理**: 完善的错误处理和重试机制

### 用户界面
- **弹窗界面**: 简洁易用的弹窗界面，支持快速操作
- **查看面板**: 功能完整的数据面板，可查看缓存内容和统计信息
- **响应式设计**: 适配不同屏幕尺寸的响应式界面

### 构建系统
- **Bun 集成**: 使用 Bun 作为运行时和包管理器
- **ESBuild**: 快速的构建工具，支持 TypeScript 和 JSX
- **自动化构建**: 一键构建所有必需文件

## 🚀 打包和发布

### 打包命令

```bash
# 基础打包
bun run package

# 开发环境打包
bun run package:dev

# 完整发布流程（清理+打包）
bun run release
```

### 打包流程
1. **清理旧包** - 删除 `release/` 目录中的旧版本
2. **构建项目** - 运行 `scripts/build.ts` 构建 dist 目录
3. **验证文件** - 检查必要的扩展文件是否存在
4. **创建版本信息** - 生成 `version.json` 包含构建信息
5. **生成 ZIP 包** - 创建适用于 Chrome Web Store 的 zip 文件
6. **生成报告** - 输出详细的打包信息

### 输出文件
```
release/
├── onlyfollow-v1.0.0.zip          # Chrome Web Store 上传文件
├── package-report-v1.0.0.json    # 详细打包报告
└── ...
```

## 🔧 技术实现亮点

### 1. 智能内容替换
参考油猴脚本的实现，保持与原生页面的一致性。只替换必要的内容（链接、标题、图片等），保留原有样式。支持动态内容检测，适应页面变化。

### 2. 高效的缓存策略
分层缓存：关注列表（24h）、内容数据（2h）、媒体资源（7d）。智能过期机制，避免重复 API 调用。存储空间监控，防止超出限制。

### 3. 模块化架构
平台适配器模式，便于扩展新平台。清晰的职责分离，提高代码可维护性。统一的接口设计，保证一致性。

## 📁 项目文件结构

```
onlyfollow/
├── src/                       # 所有源代码
│   ├── background/            # 后台服务脚本
│   ├── content/              # 内容脚本
│   │   ├── platforms/        # 平台适配器
│   │   └── managers/         # 内容管理器
│   ├── components/           # React 组件库
│   │   ├── ui/              # 基础 UI 组件
│   │   ├── layout/          # 布局组件
│   │   └── features/        # 功能组件
│   ├── pages/               # 扩展页面
│   │   ├── popup/           # 弹窗页面
│   │   ├── options/         # 选项页面
│   │   └── dashboard/       # 仪表板页面
│   ├── core/                # 核心业务逻辑
│   │   ├── cache/           # 缓存管理
│   │   ├── config/          # 配置管理
│   │   ├── content/         # 内容引擎
│   │   ├── state/           # 状态管理
│   │   └── dom/             # DOM 操作
│   ├── shared/              # 共享模块
│   │   ├── types/           # 类型定义
│   │   ├── utils/           # 工具函数
│   │   ├── constants/       # 常量定义
│   │   └── hooks/           # 自定义 hooks
│   ├── styles/              # 样式文件
│   │   ├── globals.css      # 全局样式
│   │   └── components/      # 组件样式
│   └── assets/              # 源码中的静态资源
├── public/                  # 公共静态资源 (直接复制)
│   ├── icons/              # 各尺寸图标
│   └── manifest.json       # 扩展清单
├── scripts/                # 构建和开发脚本
├── docs/                   # 项目文档
├── dist/                   # 构建输出
└── package.json            # 项目配置
```

## 🔄 开发和部署

### 开发模式
1. 运行 `bun install` 安装依赖
2. 运行 `bun run build` 构建项目
3. 在 Chrome 扩展管理页面加载 `dist` 目录

### 生产模式
构建完成后可打包为 ZIP 文件，支持 Chrome Web Store 发布。

## 🔮 后续开发计划

### 短期目标
- 完善 YouTube 平台支持
- 添加 Twitter/X 平台支持
- 优化错误处理和用户提示

### 中期目标
- 实现 Instagram 平台支持
- 添加内容过滤和排序功能
- 开发移动端适配

### 长期目标
- 支持更多社交媒体平台
- 添加数据分析和可视化
- 开发协同功能

## 🔒 安全考虑

### 数据隐私
- 所有数据处理都在本地完成
- 不上传用户数据到外部服务器
- 使用 Chrome 加密存储

### 权限最小化
- 仅请求必要的浏览器权限
- 明确的权限用途说明
- 用户可控的数据访问

## 📋 上传前检查清单

- [ ] 版本号已更新
- [ ] `manifest.json` 信息正确
- [ ] 所有图标文件存在且尺寸正确
- [ ] 插件在本地测试正常
- [ ] 隐私政策页面已创建（如需访问用户数据）
- [ ] 商店截图已准备
- [ ] ZIP 包大小合理（建议 < 50MB）

项目已具备实际使用价值，可以作为学习 Chrome 扩展开发和现代 Web 技术的优秀参考案例。