# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

OnlyFollow 是一个Chrome扩展，将各大平台的算法推荐替换为用户关注内容的随机展示，帮助用户重新掌控信息流。

## 开发原则

### 架构原则
- **平台适配器模式**: 每个平台使用独立的适配器，便于维护和扩展
- **单例模式**: 核心服务（ContentEngine、PlatformManager、ConfigManager）使用单例模式
- **事件驱动**: 组件间通过事件系统解耦通信
- **缓存优先**: 优先使用缓存数据，减少API调用，提升响应速度

### 代码规范
- **TypeScript严格模式**: 启用所有严格类型检查
- **接口优先**: 所有公共模块必须定义清晰的接口
- **错误处理**: 所有异步操作必须包含错误处理和日志记录
- **单例导出**: 使用命名导出单例实例，避免直接导入类

### 缓存策略
- **分层缓存**: 关注列表、内容数据、媒体资源使用不同过期时间
- **本地优先**: 数据处理完全在本地完成，不上传用户信息
- **自动清理**: 定期清理过期缓存，防止存储空间膨胀

### Chrome扩展集成
- **消息通信**: background和content scripts通过Chrome消息API通信
- **状态同步**: 支持多标签页间的状态同步
- **权限最小化**: 仅请求必要的浏览器权限

### 平台适配规范
- **统一接口**: 所有平台适配器必须实现 `PlatformAdapter` 接口
- **平台检测**: 使用URL模式匹配和DOM元素检测双重验证
- **容错处理**: 适配器必须处理网络异常、页面变化等异常情况
- **性能优化**: 避免重复DOM查询，合理控制API调用频率

### 状态管理
- **不可变性**: 状态更新必须创建新对象，避免直接修改
- **事件监听**: 支持状态变化监听，便于UI响应
- **持久化**: 关键状态通过Chrome Storage API持久化

### 测试和调试
- **调试模式**: 通过 `DEBUG_CONFIG` 控制日志输出
- **增量构建**: 支持热重载和增量构建，提升开发效率
- **错误边界**: 所有UI组件必须有错误边界处理